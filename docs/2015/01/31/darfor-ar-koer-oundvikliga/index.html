<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta description=" | default('Samhälle, vetenskap, kultur')">
    <meta keywords="| default('society, science, culture, Homo sapiens, evolution, liberalism')">
    <meta author=" | default('Per Kraulis')">
    <title>Därför är köer oundvikliga</title>
    <link href="/files/valen-32.png" type="image/png" rel="shortcut icon">
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/litera/bootstrap.min.css"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css"
          rel="stylesheet">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <img src="/files/valen-32.png" width="32" height="32">
        </a>
        <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown me-2">
              <a class="nav-link dropdown-toggle" href="#" id="blog" title="Blog" role="button" data-bs-toggle="dropdown" aria-expanded="false">Blogg</a>
              <ul class="dropdown-menu" aria-labelledby="blog">
                <li>
                  <a class="dropdown-item" href="/blog/" title="All posts">Alla inlägg</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/blog/en/">Posts in English</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/blog/categories/" title="All categories">Alla kategorier</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/blog/tags/" title="All tags">Alla etiketter</a>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown me-2">
              <a class="nav-link dropdown-toggle" href="#" id="sidor" title="Pages" role="button" data-bs-toggle="dropdown" aria-expanded="false">Sidor</a>
              <ul class="dropdown-menu" aria-labelledby="sidor">
                
                <li>
                  <a class="dropdown-item" href="/alexander-dugin/">Alexander Dugin</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/lista-av-bocker-och-andra-verk/">Böcker och andra verk</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/djavulens-liberal/">Djävulens liberal</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/framtidens-dna/">Framtidens DNA</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/grundkurs-i-ateism/">Grundkurs i ateism</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/karl-popper/">Karl Popper</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/MolScript/">MolScript</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/lectures/">Old lectures</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/open-science/">Open Science</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/publikationer-i-andra-media/">Publikationer i andra media</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/python/">Python code</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/svenska-debatten-om-ryssland/">Ryssland</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/per-kraulis/">Per Kraulis</a>
                </li>
                
              </ul>
            </li>
            <li class="nav-item dropdown me-2">
              <a class="nav-link dropdown-toggle" href="#" id="library" role="button" data-bs-toggle="dropdown" aria-expanded="false">Bibliotek</a>
              <ul class="dropdown-menu" aria-labelledby="library">
                <li>
                  <a class="dropdown-item" href="/library/">Alla böcker</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/library/authors/">Alla författare</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/library/subjects/">Alla ämnen</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/library/reviewed/">Recenserade böcker</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/library/rating/5/">Böcker med betyg 5</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/library/rating/4/">Böcker med betyg 4</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/library/rating/3/">Böcker med betyg 3</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/library/rating/2/">Böcker med betyg 2</a>
                </li>
                
                <li>
                  <a class="dropdown-item" href="/library/rating/1/">Böcker med betyg 1</a>
                </li>
                
              </ul>
            </li>
            
            
            
            
            
            
            <li class="nav-item me-2">
              <a class="nav-link" href="/djavulens-liberal/">Djävulens liberal</a>
            </li>
            
            
            
            
            
            
            
            <li class="nav-item me-2">
              <a class="nav-link" href="/karl-popper/">Karl Popper</a>
            </li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <li class="nav-item me-2">
              <a class="nav-link" href="/per-kraulis/">Per Kraulis</a>
            </li>
            
            
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">

      
      <header class="row my-3">
        <div class="col offset-lg-1">
          
<h1>Därför är köer oundvikliga</h1>
<h3 class="text-muted">2015-01-31</h3>

        </div>
      </header>
      

      
      <div class="row">

        
<section class="col-lg-6 offset-lg-1">
  <p><em>This blog post is also available <a href="/2015/01/31/why-queues-are-inevitable/">in English</a>.</em></p>
<p>Vi klagar gärna på köer. Varför ska vi behöva vänta? Visar inte t.ex. vårdköerna att för snåla resurser läggs på sjukvården? Jag har tittat litet närmare på detta problem.</p>
<p><strong>Min slutsats: Nej, vi är nog inte beredda att betala vad det kostar att avskaffa köerna.</strong> Mitt resultat bygger på några enkla förutsättningar, och är tillämpligt på många olika typer av verksamheter. Jag har använt datorsimuleringar för att räkna på problemet. Siffrorna talar sitt tydliga språk: <strong>Det köfria samhället är en orimlig utopi.</strong></p>
<p>Jag jobbar i en serviceverksamhet (<a href="https://portal.scilifelab.se/genomics/">National Genomics Infrastructure in Sweden</a> som befinner sig inom <a href="http://www.scilifelab.se/">SciLifeLab</a>), där vi processar prover inskickade av forskare i hela Sverige och levererar data (DNA-sekvenserna) tillbaka till dem. <strong>Det vanligaste klagomålet på oss är att vi har för långa köer. Det glunkas om att <a href="http://ki.se/">Karolinska Institutet</a>, där många av våra användare finns, funderar på att öppna en egen service, för att, som en KI-representant sa till mig, &quot;forskarna ska kunna komma ner och få sina prover körda direkt utan någon kö.&quot;</strong> Jag började fundera på det. Är den målsättningen rimlig?</p>
<p>Det finns en mycket väl utvecklad teori om detta, främst inom det fält som heter <a href="http://en.wikipedia.org/wiki/Discrete_event_simulation">Discrete Event Simulation</a>, men de grundläggande dragen är så enkla att jag programmerade det följande själv. Källkod och andra filer finns på mitt GitHub-repo <a href="https://github.com/pekrau/queue_simulation">queue_simulation</a> för den som vill titta på detaljerna.</p>
<p><strong>Ett helt grundläggande antagande som jag gör är att uppdragen kommer till serviceverksamheten helt oberoende av varandra. Det finns ingen tidsbokning, planering eller flockbeteende.</strong> En patient blir sjuk helt oberoende av andra, eller en forskare levererar ett prov till NGI helt oberoende av andra forskare. Då kan man använda en så kallad <a href="http://sv.wikipedia.org/wiki/Slumptalsgenerator">slumptalsgenerator</a>, en slags datorbaserad tärning, för att i ett datorprogram simulera processen.</p>
<p>Så vad händer om vi simulerar en serviceverksamhet dit det kommer ett antal uppdrag litet när som helst? Här är en visuell representation:</p>
<p><a href="/files/queue_50.png"><img src="/files/queue_50.png" alt="Simulation of task execution and queue. 50% utilization of resources." /></a> Simulation of task execution and queue. 50% utilization of resources.</p>
<p>I denna figur löper tiden horisontellt. Varje uppdrag visas i sin egen rad. Följande färger används:</p>
<ul>
<li><strong>Svart</strong> visar den tid det tar att utföra det uppdraget. Jag har valt att sätta den tiden till ett och samma värde för alla uppdrag, för enkelhetens skull.</li>
<li><strong>Röd</strong> visar den tid som uppdraget måste vänta innan det kan börja utföras. Detta sker när det finns andra uppdrag som hunnit före till verksamheten, och som därför behandlas före.</li>
<li><strong>Vit</strong> för markeringarna i den nedersta raden, som visar vid vilken tid varje uppdrag inkommit till verksamheten. <strong>Notera den ojämnt fördelade utspridningen!</strong> Det är så det blir om uppdragen inkommer rent slumpmässigt. Det är denna ojämnhet som är grundorsaken till de resultat jag kommer att beskriva. Denna effekt, som beror på slumpen, är ingen slump, ironiskt nog. Det är så verkligheten fungerar: slumpmässigt placerade punkter ger en ojämn fördelning.</li>
</ul>
<p>I denna simuleringen har jag valt ett så stort inflöde av uppdrag så att <strong>ungefär 50% av den totala kapaciteten</strong> hos verksamheten utnyttjas. Verksamheten står alltså utan några uppdrag att utföra hälften av tiden. <strong>Redan här kan man se något mycket intressant: Det finns ett antal tillfällen när de inkommande uppdragen tvingas vänta i kö.</strong> Närmare bestämt 35 av de 70 uppdragen i denna figur får vänta på sin tur, medan resten kan börja processas direkt när de inkommer.</p>
<p><strong>Det betyder alltså att även om man har <em>dubbelt</em> så stor kapacitet som man strikt sett egentligen behöver, så måste ungefär hälften av uppdragen ändå vänta i kö!</strong></p>
<p>Om vi är ekonomer och administratörer, eller den som faktiskt betalar kalaset, så kanske vi vill ha en mer effektiv verksamhet, så att <strong>den arbetar, låt oss säga, 90% av sin kapacitet</strong>, och står sysslolös endast 10% av tiden. Det kan ju verka rimligt? Följande händer då:</p>
<p><a href="/files/queue_90.png"><img src="/files/queue_90.png" alt="Simulation of task execution and queue. 90% utilization of resources." /></a> Simulation of task execution and queue. 90% utilization of resources.</p>
<p>Usch då! En himla massa rött, vilket betyder lång väntan för många uppdrag.</p>
<ul>
<li>Den stora majoriteten av uppdrag råkar ut för kö. I det här fallet 87 av 100.</li>
<li>De som råkar ut för kö ligger i den länge: i genomsnitt 19.1 dagar (jämfört med de 5 dagar som ett uppdrag tar att utföra; den tiden satte jag godtyckligt i denna simuleringen).</li>
<li>Notera de långa diagonalerna av svarta block: Det visar att verksamheten arbetar utan uppehåll under långa perioder.</li>
</ul>
<p>Om detta skulle handla om en akutmottagning, så skulle nog massmedia publicera katastrofreportage om de förfärliga köerna, och personalen skulle riskera utbrändhet. Och då finns det trots allt 10% glapp i systemet!</p>
<p><strong>Slutsats: En verksamhet som inte kan styra eller planera inflödet av uppdrag kommer att få orimliga köer om antalet inkomna uppdrag närmar sig den totala kapaciteten. Köerna är inte ett tecken på att kapaciteten rent principiellt är för låg! Det finns ju 10% som inte används, totalt sett. Ändå kommer alla att tycka att det är katastrof. Detta är en viktig men ofta förbisedd insikt.</strong></p>
<p>Om vi istället tittar på det som ovannämnde KI-representanten eftersträvar: En verksamhet som är i det närmaste utan köer. Hur uppnår vi det? Låt oss lägga <strong>utnyttjandegraden på ett extremt lågt värde: 20%</strong>. Så här ser det ut:</p>
<p><a href="/files/queue_20.png"><img src="/files/queue_20.png" alt="Simulation of task execution and queue. 20% utilization of resources." /></a> Simulation of task execution and queue. 20% utilization of resources.</p>
<p>Här blir det nästan köfritt; mycket litet rött syns. Men ändå litet grann! Och vi ser också långa sträckor där mycket litet händer: Verksamheten rullar tummarna. Den som betalar för verksamheten blir nog litet fundersam. <strong>Lyxen att bli av med köerna är nämligen just det: en lyx. Verksamheten är 5 gånger större än den principiellt behöver vara, det är det som 20% utnyttjandegrad innebär.</strong></p>
<p>Man skulle självklart kunna gå mer på djupet i dessa frågor, och visa grafer som relaterar förekomst av kö, eller medellängd på kön, till hur stor nyttjandegrad man har. Men jag avstår i detta inlägg, det är tillräckligt långt som det är. Man kan också diskutera om man kan förändra det grundläggande antagandet jag gör i analysen, nämligen att uppdragen inkommer vid slumpmässiga tidpunkter. Visst, man kan i vissa fall (dock inte akut sjukhusvård) tänka sig andra system, som t.ex. tidsbokning, som skulle minska eländet. Men de lösningarna har egna problem som det skulle leda för långt att här resonera om.</p>
<p><strong>Jag vill avsluta med följande uppmaning till de som klagar på långa köer, i vård eller i andra sammanhang: Är ni beredda att betala för den överkapacitet som behövs för att uppnå frånvaron av köer?</strong> För även om verksamheten skulle betalas av andra, rent tekniskt, så ska man inte inbilla sig att det inte kostar samhällsekonomin något. Har man en verksamhet vars kapacitet är långt större än vad den principiellt behöver vara, så innebär det dödtid, och därmed slöseri: Resurser felallokeras. Används till ingen nytta. Kunde ha använts till annat. Betänk det innan ni börjar gnälla.</p>

</section>


        
<aside class="col-lg-3 offset-lg-2">

  <ul class="list-group">
    
    <li class="list-group-item">
      Föregående inlägg:
      <a href="/2015/01/31/why-queues-are-inevitable/">Why queues are inevitable</a>
    </li>
    
    
    <li class="list-group-item">
      Nästa inlägg:
      <a href="/2015/02/15/timothy-garton-ash-om-charlie-hebdo/">Timothy Garton Ash om Charlie Hebdo</a>
    </li>
    
  </ul>

  

  
  <div class="card mt-3">
    <div class="card-header bg-light" title="Categories">
      Kategorier
    </div>
    <div class="card-body">
      
      <a href="/blog/categories/computing" class="text-nowrap">Computing</a>
      <br>
      
      <a href="/blog/categories/vetenskap-science" class="text-nowrap">Vetenskap (science)</a>
      <br>
      
    </div>
  </div>
  

  
  <div class="card mt-3">
    <div class="card-header bg-light" title="Tags">
      Etiketter
    </div>
    <div class="card-body">
      
      <a href="/blog/tags/koer" class="text-nowrap" title="1">köer</a>
      <br>
      
      <a href="/blog/tags/ngi" class="text-nowrap" title="2">NGI</a>
      <br>
      
      <a href="/blog/tags/scilifelab" class="text-nowrap" title="2">SciLifeLab</a>
      <br>
      
      <a href="/blog/tags/simulering" class="text-nowrap" title="2">simulering</a>
      <br>
      
    </div>
  </div>
  

</aside>


      </div>
      

      <footer class="row">
        <div class="col offset-lg-1">
          <hr>
          
          
        </div>
      </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
  </body>
</html>